(function () {
    // Local loader for Select2: requires jQuery. If Select2 not present, load from CDN.
    function loadSelect2() {
        if (window.jQuery && window.jQuery.fn && window.jQuery.fn.select2) return;
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js';
        s.onload = function () { console.info('Select2 loaded from CDN'); };
        s.onerror = function () { console.warn('Failed to load Select2 from CDN'); };
        document.head.appendChild(s);
    }

    if (!window.jQuery) {
        // wait for jQuery to load, try again later
        var tries = 0;
        var t = setInterval(function () {
            tries += 1;
            if (window.jQuery) { clearInterval(t); loadSelect2(); }
            if (tries > 50) { clearInterval(t); console.warn('jQuery not found; cannot load Select2'); }
        }, 100);
    } else {
        loadSelect2();
    }
})();
