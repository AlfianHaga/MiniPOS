{% extends 'base.html' %}
{% load humanize currency_filters %}
{% block title %}Stok Menipis{% endblock %}
{% block page_title %}
  {% include 'pos/_hero.html' with title='Produk Stok Menipis' subtitle='Daftar produk dengan stok kurang dari 5' icon='bi bi-exclamation-triangle' %}
{% endblock %}
{% block content %}
<div class="alert alert-warning mb-3" role="alert">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  <strong>Total {{ low_stock_count }} produk</strong> memerlukan restok segera.
</div>

<div class="card p-3">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead>
        <tr>
          <th>Produk</th>
          <th>Kategori</th>
          <th class="text-end">Stok</th>
          <th class="text-end">Harga</th>
          <th class="text-end">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>
            <div class="d-inline-flex align-items-center gap-1" style="max-width:100%">
              <span class="truncate" title="{{ product.name }}">{{ product.name }}</span>
              {% if product.stock == 0 %}
                <span class="badge bg-danger">Habis</span>
              {% else %}
                <span class="badge bg-warning text-dark">Menipis</span>
              {% endif %}
            </div>
          </td>
          <td>
            {% if product.category %}
              <span class="badge bg-secondary">{{ product.category.name }}</span>
            {% else %}
              -
            {% endif %}
          </td>
          <td class="text-end">
            <span class="{% if product.stock == 0 %}text-danger{% else %}text-warning{% endif %} fw-bold">
              {{ product.stock }}
            </span>
          </td>
          <td class="text-end price">{{ product.price|idr }}</td>
          <td class="actions text-end">
            <a class="btn btn-sm btn-outline-primary" href="{% url 'product_update' product.id %}" title="Edit untuk menambah stok">
              <i class="bi bi-pencil"></i> Edit
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-success">
            <i class="bi bi-check-circle me-2"></i>
            Semua produk memiliki stok yang cukup!
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="mt-3">
  <a href="{% url 'dashboard' %}" class="btn btn-secondary">
    <i class="bi bi-arrow-left"></i> Kembali ke Dashboard
  </a>
</div>
{% endblock %}
