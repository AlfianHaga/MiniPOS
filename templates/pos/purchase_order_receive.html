{% extends 'base.html' %}
{% load humanize currency_filters %}
{% block title %}Terima PO {{ purchase_order.order_number }}{% endblock %}
{% block page_title %}
  {% include 'pos/_hero.html' with title='Terima Barang' subtitle='Konfirmasi penerimaan purchase order' icon='bi bi-clipboard-check' %}
{% endblock %}
{% block content %}
<div class="card p-4">
  <div class="alert alert-info">
    <i class="bi bi-info-circle-fill me-2"></i>
    <strong>Konfirmasi Penerimaan Barang</strong>
    <p class="mt-2 mb-0">Purchase Order: <strong>{{ purchase_order.order_number }}</strong></p>
    <p class="mb-0">Supplier: <strong>{{ purchase_order.supplier.name }}</strong></p>
  </div>

  <h6 class="mb-3">Item yang akan diterima:</h6>
  <div class="table-responsive mb-3">
    <table class="table table-sm table-bordered">
      <thead>
        <tr>
          <th>Produk</th>
          <th class="text-end">Stok Saat Ini</th>
          <th class="text-end">Jumlah Terima</th>
          <th class="text-end">Stok Setelah</th>
        </tr>
      </thead>
      <tbody>
        {% for item in purchase_order.items.all %}
        <tr>
          <td>{{ item.product.name }}</td>
          <td class="text-end">{{ item.product.stock }}</td>
          <td class="text-end text-success fw-bold">+{{ item.quantity }}</td>
          <td class="text-end fw-bold">{{ item.product.stock|add:item.quantity }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <strong>Peringatan!</strong> Setelah dikonfirmasi, stok produk akan langsung bertambah dan status PO akan berubah menjadi "Diterima". Aksi ini tidak dapat dibatalkan.
  </div>

  <form method="post">
    {% csrf_token %}
    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success">
        <i class="bi bi-check-circle"></i> Ya, Terima Barang
      </button>
      <a href="{% url 'purchase_order_detail' purchase_order.id %}" class="btn btn-secondary">Batal</a>
    </div>
  </form>
</div>
{% endblock %}
